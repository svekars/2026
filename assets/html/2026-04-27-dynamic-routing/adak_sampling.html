<html>
<head>
    <meta charset="utf-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #plot-container {
            margin-bottom: 20px;
        }
        button {
            background-color: #636efa;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #4a5cd4;
        }
        button:active {
            background-color: #3a4ab4;
        }
        #sampled-k {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #636efa;
        }
    </style>
</head>
<body>
    <div class="row justify-content-center">
        <div class="col-md-3">
            <button id="sample-button" onclick="sampleK()">Sample k</button>
        </div>
        <div class="col-md-3">
            <div id="sampled-k"></div>
        </div>
    </div>
    <div id="plot-container"></div>

    <script>
        // Probability distribution
        // const probabilities = [0.16327495, 0.15754719, 0.14104774, 0.13594392, 0.13031779, 0.09640901, 0.09212957, 0.08332983];
        const probabilities = [0.09212957, 0.14104774, 0.13031779, 0.09640901, 0.16327495, 0.08332983, 0.13594392, 0.15754719];
        const numExperts = probabilities.length;
        const expertLabels = Array.from({length: numExperts}, (_, i) => `Expert ${i + 1}`);
        
        // Initial colors (all in #ef553b)
        let barColors = Array(numExperts).fill('#ef553b');

        // Create initial trace
        const trace = {
            x: expertLabels,
            y: probabilities,
            type: 'bar',
            marker: {
                color: barColors,
                line: {
                    color: 'rgba(0,0,0,0.5)',
                    width: 1
                }
            },
            text: probabilities.map(p => p.toFixed(4)),
            textposition: 'outside',
            hovertemplate: '<b>%{x}</b><br>Probability: %{y:.4f}<extra></extra>'
        };

        const layout = {
            title: {
                text: 'Ada-K Sampling: Probability Distribution',
                font: { size: 18 }
            },
            xaxis: {
                title: 'Expert',
                tickangle: -45
            },
            yaxis: {
                title: 'Probability',
                range: [0, Math.max(...probabilities) * 1.2]
            },
            showlegend: false,
            margin: { l: 60, r: 20, t: 60, b: 80 },
            height: 400
        };

        const config = {
            responsive: true,
            displayModeBar: false
        };

        // Initialize plot
        Plotly.newPlot('plot-container', [trace], layout, config);

        // Sampling function
        function sampleK() {
            // Sample one expert based on the probability distribution
            const random = Math.random();
            let cumulative = 0;
            let sampledExpertIndex = 0;
            
            for (let i = 0; i < probabilities.length; i++) {
                cumulative += probabilities[i];
                if (random <= cumulative) {
                    sampledExpertIndex = i; // 0-indexed
                    break;
                }
            }
            
            // Reset all bars to default color, then highlight only the sampled one
            barColors = probabilities.map((_, i) => 
                i === sampledExpertIndex ? '#636efa' : '#ef553b'
            );
            
            // Update the plot
            Plotly.restyle('plot-container', {
                'marker.color': [barColors]
            });
            
            // Update the displayed k value (1-indexed)
            const sampledK = sampledExpertIndex + 1;
            document.getElementById('sampled-k').textContent = `Sampled k = ${sampledK}`;
        }
    </script>
</body>
</html>
